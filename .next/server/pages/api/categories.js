"use strict";(()=>{var e={};e.id=957,e.ids=[957],e.modules={1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},3731:(e,t,r)=>{r.r(t),r.d(t,{config:()=>h,default:()=>p,routeModule:()=>m});var n={};r.r(n),r.d(n,{default:()=>d});var o=r(1802),i=r(7153),a=r(6249),s=r(1004),u=r(7309),c=r(6314),l=r(1152);async function d(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{await (0,s.Z)();let{nav:r}=e.query,n=r?"categories:nav":"categories:all";try{let e=await l.Z.get(n);if(e){let r=JSON.parse(e);return(0,c.Xj)(t,r,"获取分类列表成功")}}catch(e){console.warn("Redis cache error:",e)}let o=await u.Z.find({isActive:!0}).select(r?"name slug icon color order":"").sort({order:1,name:1}).lean();if(!o||0===o.length)return(0,c.Xj)(t,[{_id:"1",name:"人工智能",slug:"ai",icon:"\uD83E\uDD16",color:"#3B82F6",order:1,description:"人工智能相关新闻"},{_id:"2",name:"科技",slug:"tech",icon:"\uD83D\uDCBB",color:"#10B981",order:2,description:"科技行业新闻"},{_id:"3",name:"商业",slug:"business",icon:"\uD83D\uDCBC",color:"#F59E0B",order:3,description:"商业财经新闻"}],"获取分类列表成功");try{await l.Z.set(n,JSON.stringify(o),300)}catch(e){console.warn("Redis cache set error:",e)}return(0,c.Xj)(t,o,"获取分类列表成功")}catch(e){return console.error("获取分类列表失败:",e),(0,c.Xj)(t,[{_id:"1",name:"人工智能",slug:"ai",icon:"\uD83E\uDD16",color:"#3B82F6",order:1},{_id:"2",name:"科技",slug:"tech",icon:"\uD83D\uDCBB",color:"#10B981",order:2}],"获取分类列表成功（使用默认数据）")}}let p=(0,a.l)(n,"default"),h=(0,a.l)(n,"config"),m=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/categories",pathname:"/api/categories",bundlePath:"",filename:""},userland:n})},6314:(e,t,r)=>{r.d(t,{VR:()=>o,Xj:()=>n});let n=(e,t=null,r="Success",n=200)=>e.status(n).json({success:!0,message:r,data:t,timestamp:new Date().toISOString()}),o=(e,t="Error",r=500,n=null)=>e.status(r).json({success:!1,message:t,error:null,timestamp:new Date().toISOString()})},1004:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(1185),o=r.n(n);let i=process.env.MONGO_URI;if(!i)throw Error("请在环境变量中定义MONGO_URI");let a=global.mongoose;a||(a=global.mongoose={conn:null,promise:null});let s=async function(){if(a.conn)return a.conn;a.promise||(a.promise=o().connect(i,{bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}},1152:(e,t,r)=>{r.d(t,{Z:()=>a});let n=process.env.REDIS_URL,o=process.env.REDIS_TOKEN;if(!n||!o)throw Error("请在环境变量中定义REDIS_URL和REDIS_TOKEN");class i{constructor(){this.baseUrl=n,this.token=o}async execute(e){try{let t=await fetch(`${this.baseUrl}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(`Redis请求失败: ${t.status}`);return(await t.json()).result}catch(e){throw console.error("Redis操作错误:",e),e}}async set(e,t,r=null){return await this.execute(r?["SET",e,t,"EX",r]:["SET",e,t])}async get(e){return await this.execute(["GET",e])}async del(e){return await this.execute(["DEL",e])}async exists(e){return await this.execute(["EXISTS",e])}async expire(e,t){return await this.execute(["EXPIRE",e,t])}async keys(e){return await this.execute(["KEYS",e])}async lpush(e,t){return await this.execute(["LPUSH",e,t])}async rpop(e){return await this.execute(["RPOP",e])}async llen(e){return await this.execute(["LLEN",e])}async lrange(e,t,r){return await this.execute(["LRANGE",e,t,r])}}let a=new i},7309:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(1185),o=r.n(n);let i=new(o()).Schema({name:{type:String,required:!0,unique:!0},slug:{type:String,required:!0,unique:!0},description:{type:String,default:""},icon:{type:String,default:""},color:{type:String,default:"#3B82F6"},order:{type:Number,default:0},isActive:{type:Boolean,default:!0},metadata:{type:o().Schema.Types.Mixed,default:{}}},{timestamps:!0});i.index({slug:1}),i.index({isActive:1}),i.index({order:1});let a=o().models.Category||o().model("Category",i)},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=3731);module.exports=r})();