"use strict";(()=>{var e={};e.id=801,e.ids=[801],e.modules={1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},1740:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>d,routeModule:()=>g});var a={};r.r(a),r.d(a,{default:()=>c});var i=r(1802),n=r(7153),s=r(6249),u=r(1004),o=r(1367),l=r(1152);async function c(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{await (0,u.Z)();let{category:r,page:a=1,limit:i=10,sort:n="publishedAt"}=e.query,s=parseInt(a),c=parseInt(i),d=(s-1)*c,p=`news:list:${r||"all"}:page:${s}:limit:${c}:sort:${n}`;try{let e=await l.Z.get(p);if(e){let r=JSON.parse(e);return t.status(200).json(r)}}catch(e){console.warn("Redis cache error:",e)}let g={};r&&"all"!==r&&(g.category=r);let y={};switch(n){case"views":y={views:-1,publishDate:-1};break;case"likes":y={likes:-1,publishDate:-1};break;default:y={publishDate:-1}}let[m,h]=await Promise.all([o.Z.find(g).select("title summary author publishDate category tags views likes imageUrl source").sort(y).skip(d).limit(c).lean(),o.Z.countDocuments(g)]),S={success:!0,data:m,pagination:{currentPage:s,totalPages:Math.ceil(h/c),totalItems:h,itemsPerPage:c,hasNextPage:s<Math.ceil(h/c),hasPrevPage:s>1},message:"获取新闻列表成功"};try{await l.Z.set(p,JSON.stringify(S),300)}catch(e){console.warn("Redis cache set error:",e)}return t.status(200).json(S)}catch(a){console.error("获取新闻列表失败:",a);let r={success:!0,data:[],pagination:{currentPage:parseInt(e.query.page)||1,totalPages:0,totalItems:0,itemsPerPage:parseInt(e.query.limit)||10,hasNextPage:!1,hasPrevPage:!1},message:"获取新闻列表成功（暂无数据）"};return t.status(200).json(r)}}let d=(0,s.l)(a,"default"),p=(0,s.l)(a,"config"),g=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/news",pathname:"/api/news",bundlePath:"",filename:""},userland:a})},1004:(e,t,r)=>{r.d(t,{Z:()=>u});var a=r(1185),i=r.n(a);let n=process.env.MONGO_URI;if(!n)throw Error("请在环境变量中定义MONGO_URI");let s=global.mongoose;s||(s=global.mongoose={conn:null,promise:null});let u=async function(){if(s.conn)return s.conn;s.promise||(s.promise=i().connect(n,{bufferCommands:!1}).then(e=>e));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}},1152:(e,t,r)=>{r.d(t,{Z:()=>s});let a=process.env.REDIS_URL,i=process.env.REDIS_TOKEN;if(!a||!i)throw Error("请在环境变量中定义REDIS_URL和REDIS_TOKEN");class n{constructor(){this.baseUrl=a,this.token=i}async execute(e){try{let t=await fetch(`${this.baseUrl}`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(`Redis请求失败: ${t.status}`);return(await t.json()).result}catch(e){throw console.error("Redis操作错误:",e),e}}async set(e,t,r=null){return await this.execute(r?["SET",e,t,"EX",r]:["SET",e,t])}async get(e){return await this.execute(["GET",e])}async del(e){return await this.execute(["DEL",e])}async exists(e){return await this.execute(["EXISTS",e])}async expire(e,t){return await this.execute(["EXPIRE",e,t])}async keys(e){return await this.execute(["KEYS",e])}async lpush(e,t){return await this.execute(["LPUSH",e,t])}async rpop(e){return await this.execute(["RPOP",e])}async llen(e){return await this.execute(["LLEN",e])}async lrange(e,t,r){return await this.execute(["LRANGE",e,t,r])}}let s=new n},1367:(e,t,r)=>{r.d(t,{Z:()=>d});var a=r(1185),i=r.n(a);let n=new(i()).Schema({name:{type:String,required:!0},type:{type:String,required:!0},description:{type:String,required:!0}}),s=new(i()).Schema({name:{type:String,required:!0},value:{type:String,required:!0},description:{type:String,required:!0}}),u=new(i()).Schema({date:{type:String,required:!0},event:{type:String,required:!0}}),o=new(i()).Schema({entities:[n],metrics:[s],timeline:[u]}),l=new(i()).Schema({type:{type:String,required:!0},title:{type:String,required:!0},data:{type:i().Schema.Types.Mixed,required:!0},xAxisKey:String,yAxisKeys:[String],pieKey:String,valueKey:String,colors:[String]}),c=new(i()).Schema({title:{type:String,required:!0},summary:{type:String,required:!0},content:{type:String,required:!0},category:{type:String,required:!0},tags:{type:[String],required:!0},publishDate:{type:Date,required:!0,default:Date.now},source:{type:String,required:!0},sourceUrl:{type:String,required:!0},imageUrl:String,author:String,trending:{type:Boolean,default:!1},isRealtime:{type:Boolean,default:!1},structuredInfo:o,visualizationData:[l],aiSummary:String,readTime:Number,views:{type:Number,default:0},likes:{type:Number,default:0},shares:{type:Number,default:0}},{timestamps:!0});c.index({publishDate:-1}),c.index({category:1}),c.index({trending:1}),c.index({tags:1}),c.index({title:"text",summary:"text",content:"text"});let d=i().models.News||i().model("News",c)},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=1740);module.exports=r})();